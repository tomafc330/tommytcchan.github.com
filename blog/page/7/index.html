
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Tommy Chan's software blog (@tommytcchan)</title>
  <meta name="author" content="Tommy Chan (informotion software)">

  
  <meta name="description" content="I was working on a refactoring for a method that did csv export, and I found a prime a candidate for using the currying mechanism in Groovy. Consider &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tommytcchan.github.com/blog/page/7/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Tommy Chan's software blog (@tommytcchan)" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-38195602-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <link href='http://fonts.googleapis.com/css?family=Ubuntu:400,500' rel='stylesheet' type='text/css'> 
  <meta property="og:url" content="http://tommytcchan.github.com/blog/page/7/index.html">
<meta property="og:type" content="website" />

<meta property="og:title" content="Tommy Chan's software blog (@tommytcchan)">
<meta property="og:description" content="This is a software blog for Tommy Chan.">
 


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Tommy Chan's software blog (@tommytcchan)</a></h1>
  
    <h2>Chronicling my journey through what they call software development.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tommytcchan.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/08/groovy-the-way-to-populate-a-csv-slash-excel-file/">Groovy: The Way to Populate a Csv/excel File.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-08T13:52:00-08:00" pubdate data-updated="true">Mar 8<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/03/08/groovy-the-way-to-populate-a-csv-slash-excel-file/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I was working on a refactoring for a method that did csv export, and I found a prime a candidate for using the currying mechanism in Groovy.</p>

<p>Consider this example of the code before:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def export = {
</span><span class='line'>  final string[] csvcolumnheadings = ['game', 'campaign name', 'campaign medium', 'campaign code', 'campaign term', 'campaign content',
</span><span class='line'>      'campaign source', 'additional paramter','status', 'created by', 'updated by', 'date created', 'last updated']
</span><span class='line'>  
</span><span class='line'>  ...
</span><span class='line'>
</span><span class='line'>      campaigns.resultset.each { campaign -&gt;
</span><span class='line'>          string[] row = new string[13]
</span><span class='line'>          
</span><span class='line'>          row[0] = campaign.game ? campaign.game : ''
</span><span class='line'>          row[1] = campaign.campaignname ? campaign.campaignname : ''
</span><span class='line'>          row[2] = campaign.type ? campaign.type.tostring() : ''
</span><span class='line'>          row[3] = campaign.campaigncode ? campaign.campaigncode : ''
</span><span class='line'>          row[4] = campaign.campaignterm ?: ''
</span><span class='line'>          row[5] = campaign.campaigncontent?: ''
</span><span class='line'>          row[6] = campaign.source ? campaign.source : ''
</span><span class='line'>          row[7] = campaign.parameter ? campaign.parameter : ''
</span><span class='line'>          row[8] = campaign.status.name ? campaign.status.name : ''
</span><span class='line'>          row[9] = campaign.createdby ? campaign.createdby : ''
</span><span class='line'>          row[10] = campaign.updatedby ? campaign.updatedby : ''
</span><span class='line'>          row[11] = campaign.datecreated ? campaign.datecreated.getdatetimestring() : ''
</span><span class='line'>          row[12] = campaign.lastupdated ? campaign.lastupdated.getdatetimestring() : ''
</span><span class='line'>          
</span><span class='line'>          csvwriter.writenext(row)
</span><span class='line'>      }
</span><span class='line'>
</span><span class='line'>  ...
</span><span class='line'>      
</span><span class='line'>} </span></code></pre></td></tr></table></div></figure>


<p>So what&#8217;s the problem here? Well, I was adding a couple of fields to the export, and the problem is that there are 4 things I needed to do:
* Add it to the <code>csvcolumnheadings</code>
* Update the number of elements in decl of the array <code>row</code>
* Add the elements
* Update all the numberings</p>

<p>Also, it&#8217;s not a very Groovy way of doing it. Come curryin to the rescue!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def valRetrieveFunc = {fieldName, campaign -&gt;
</span><span class='line'>      def result
</span><span class='line'>
</span><span class='line'>      if (fieldName instanceof Closure) {
</span><span class='line'>          result = fieldName(campaign)
</span><span class='line'>      } else {
</span><span class='line'>          result = campaign."${fieldName}"
</span><span class='line'>      }
</span><span class='line'>
</span><span class='line'>      return result ?: ''
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  final Map map = [
</span><span class='line'>          'Game': valRetrieveFunc.curry('game'),
</span><span class='line'>          'Campaign Name': valRetrieveFunc.curry('campaignName'),
</span><span class='line'>          'Campaign Medium': valRetrieveFunc.curry({campaign -&gt; return campaign.type?.toString()}),
</span><span class='line'>          'Campaign Code': valRetrieveFunc.curry('campaignCode'),
</span><span class='line'>          'Campaign Term': valRetrieveFunc.curry('campaignTerm'),
</span><span class='line'>          'Campaign Content': valRetrieveFunc.curry('campaignContent'),
</span><span class='line'>          'Campaign Source': valRetrieveFunc.curry('source'),
</span><span class='line'>          'Additional Paramter': valRetrieveFunc.curry('parameter'),
</span><span class='line'>          'Status': valRetrieveFunc.curry({campaign -&gt; return campaign.status?.name}),
</span><span class='line'>          'Created By': valRetrieveFunc.curry('createdBy'),
</span><span class='line'>          'Updated By': valRetrieveFunc.curry('updatedBy'),
</span><span class='line'>          'Date Created': valRetrieveFunc.curry({campaign -&gt; return campaign.dateCreated?.getDateTimeString()}),
</span><span class='line'>          'Last Updated': valRetrieveFunc.curry({campaign -&gt; return campaign.lastUpdated?.getDateTimeString()})]
</span><span class='line'>
</span><span class='line'>  final String[] csvColumnHeadings = map.keySet()
</span><span class='line'>
</span><span class='line'>  ...
</span><span class='line'>
</span><span class='line'>      campaigns.resultSet.each { campaign -&gt;
</span><span class='line'>          def row = []
</span><span class='line'>          csvColumnHeadings.each({
</span><span class='line'>              row &lt;&lt; map[it](campaign)
</span><span class='line'>          })
</span><span class='line'>
</span><span class='line'>          csvWriter.writeNext(row.toArray() as String[])
</span><span class='line'>      }
</span><span class='line'>
</span><span class='line'>  ...                 </span></code></pre></td></tr></table></div></figure>


<p>Let me annotate this a little bit. The first thing we define was a func on how to get the parameter from the domain object. Notice for complex retrievals we can pass in a closure to how to fetch the object graph. The more important bit here is the <code>curry</code> method, which defines a new closure with the same content, except that the first parameter has been <code>curried</code> and embedded in the new closure. By using <code>curry</code> in this way, the caller of the curried closure doesn&#8217;t need worry about the first parameter..they can just invoke it with the campaign object in this case (ie. <code>row &lt;&lt; map[it](campaign)</code>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/01/rails-correct-way-of-before-save-in-model/">Rails: Correct Way of Before_save in Model</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-01T19:09:00-08:00" pubdate data-updated="true">Mar 1<span>st</span>, 2013</time>
        
         | <a href="/blog/2013/03/01/rails-correct-way-of-before-save-in-model/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So I was reading a tutorial on the before_save and thought this was a valid syntax:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  def before_save(record)
</span><span class='line'>
</span><span class='line'>    if record.publishing
</span><span class='line'>      Tip.find_all_by_publishing(true).each do |publishing_tip|
</span><span class='line'>        publishing_tip.publishing = false
</span><span class='line'>        publishing_tip.published = true
</span><span class='line'>        publishing_tip.save
</span><span class='line'>      end
</span><span class='line'>    end</span></code></pre></td></tr></table></div></figure>


<p>Turned out that this is the valid syntax for Rails 3.1:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  before_save :update_publishing_state
</span><span class='line'>
</span><span class='line'>  def update_publishing_state
</span><span class='line'>    if self.publishing
</span><span class='line'>      Tip.find_all_by_publishing(true).each do |publishing_tip|
</span><span class='line'>        publishing_tip.publishing = false
</span><span class='line'>        publishing_tip.published = true
</span><span class='line'>        publishing_tip.save
</span><span class='line'>      end
</span><span class='line'>    end
</span><span class='line'>  end</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/28/apache2-negotiation-discovered-file-s-matching-request-dot-dot-dot-yi-none-could-be-negotiated/">Apache2: Negotiation: Discovered File(s) Matching Request: &#8230;yi (None Could Be Negotiated)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-28T20:32:00-08:00" pubdate data-updated="true">Feb 28<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/02/28/apache2-negotiation-discovered-file-s-matching-request-dot-dot-dot-yi-none-could-be-negotiated/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I received this message in my apache logs while accessing a rewrite on PHP 5.4:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Thu Feb 28 20:29:44 2013] [error] [client 127.0.0.1] Negotiation: discovered file(s) matching request: /home/ad/repo/yii/backend (None could be negotiated).</span></code></pre></td></tr></table></div></figure>


<p>It turned out that I needed to add an extra type defn for PHP 5.4:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>AddType application/x-httpd-php .php</span></code></pre></td></tr></table></div></figure>


<p>source: http://serverfault.com/questions/372733/apache-file-negotiation-failed</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/28/apache2-hosting-sever-from-a-user-directory-requires-x7x-permission/">Apache2: Hosting Sever From a User Directory Requires X7x Permission</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-28T20:07:00-08:00" pubdate data-updated="true">Feb 28<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/02/28/apache2-hosting-sever-from-a-user-directory-requires-x7x-permission/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve been experimenting running a webapp in a a directory where I host my code, and in order for the server to read the dir, the base directory had to be x7x, such as</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo chmod 774 repo</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/28/css-image-not-aligning-quite-right/">CSS: Margin-top Selector Not Working.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-28T14:51:00-08:00" pubdate data-updated="true">Feb 28<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/02/28/css-image-not-aligning-quite-right/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>The problem:</h3>

<p>So I&#8217;m trying to set margin-top on a div that contains an image:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div class="affiliate-logo"&gt;&lt;a href="http://www.gamechannel.de"&gt;&lt;img src="/logo.png"&gt;&lt;/a&gt;&lt;/div&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>.affiliate-logo {
</span><span class='line'>    margin-top: 15px;
</span><span class='line'>    text-align: center;
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>However, the margin-top didn&#8217;t work at all for whatever value I put in.</p>

<h3>The solution:</h3>

<p>Turns out that you have to float the div and make that 100% width in order for the margin-top to kick in:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.affiliate-logo {
</span><span class='line'>    float: left;
</span><span class='line'>    margin-top: 15px;
</span><span class='line'>    text-align: center;
</span><span class='line'>    width: 100%;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/26/apache-ssl-error-98-address-already-in-use-make-sock-could-not-bind-to-address-0-dot-0-0-dot-0-443/">Apache: SSL Error: (98)Address Already in Use: Make_sock: Could Not Bind to Address 0.0.0.0:443</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-26T17:49:00-08:00" pubdate data-updated="true">Feb 26<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/02/26/apache-ssl-error-98-address-already-in-use-make-sock-could-not-bind-to-address-0-dot-0-0-dot-0-443/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So I&#8217;m now configuring SSL with my new httpd server, and for some reason it kept giving me this error when I first started the server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(98)Address already in use: make_sock: could not bind to address 0.0.0.0:443</span></code></pre></td></tr></table></div></figure>


<p>But I did an <code>lsof -i :443</code> and I didn&#8217;t see anything.</p>

<h3>The solution</h3>

<p>Turns out that I forgotten that Ubuntu&#8217;s setup for httpd is a little non standard, in that they included a ports.conf file that includes a conditional which will start listening on port 443 if the ssl mod is enabled. I had also included a <code>listen 443</code> in my configuration, which led to the problem.</p>

<p>Removing the <code>listen 443</code> in my declaration solved the problem.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/26/apache-setting-up-rewrite-rules-for-a-server-in-ubuntu-12-dot-10/">Apache: Setting Up Rewrite Rules for a Server in Ubuntu 12.10</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-26T15:26:00-08:00" pubdate data-updated="true">Feb 26<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/02/26/apache-setting-up-rewrite-rules-for-a-server-in-ubuntu-12-dot-10/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Introduction</h3>

<p>So I was configuring a Java app today, trying to get it deployed on httpd using ajp on Ubuntu. However, there was twist to it, and it is that the /static resources would have to point to a local file system folder (checked out with SCM).</p>

<p>I&#8217;m going to document how this is done on Ubuntu since it was somewhat of a painful process.</p>

<h3>Setup</h3>

<p>I had apache2 install via <code>apt-get</code>. The next step was to configure the apache2 server. The first thing needed was to specify the directory where the /static path resources will look in:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;Directory "~/web-assets"&gt;
</span><span class='line'>    Options Indexes FollowSymLinks
</span><span class='line'>    AllowOverride None
</span><span class='line'>    Order allow,deny
</span><span class='line'>    Allow from all
</span><span class='line'>&lt;/Directory&gt;</span></code></pre></td></tr></table></div></figure>


<p>The next thing to do is to set up the ajp port.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;VirtualHost *:80&gt;
</span><span class='line'>  ...
</span><span class='line'>  
</span><span class='line'>  ProxyPass           /           ajp://localhost:8010/
</span><span class='line'>  ProxyPassReverse    /           ajp://localhost:8010/
</span><span class='line'>
</span><span class='line'>  ProxyPreserveHost On
</span><span class='line'>
</span><span class='line'>  ...
</span><span class='line'>      
</span><span class='line'>&lt;/VirtualHost&gt;</span></code></pre></td></tr></table></div></figure>


<p>We then need to set up the rewrite rule:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(...same VirtualHost declaration...)
</span><span class='line'>RewriteRule       ^/static/\d+/(.*)                               %{DOCUMENT_ROOT}/world/$1       [L,E=STATIC_ASSET:1]
</span><span class='line'>RewriteRule       ^/static/(.*)                                   %{DOCUMENT_ROOT}/world/$1       [L,E=STATIC_ASSET:1]
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>It&#8217;s also good to have logging:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(...same VirtualHost declaration...)
</span><span class='line'># logging
</span><span class='line'>RewriteLog "/home/tchan/logs/rewrite.log"
</span><span class='line'>RewriteLogLevel 3
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>Now enable the mods (using a2enmod):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>a2enmod proxy
</span><span class='line'>a2enmod rewrite
</span><span class='line'>a2enmod ssl</span></code></pre></td></tr></table></div></figure>


<p>You might not need proxy or ssl but I did.</p>

<p>The next thing you need to do is to set up the permissions on your folder:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd ~/web-assets
</span><span class='line'>chmod a=rwx -R *</span></code></pre></td></tr></table></div></figure>


<p>Note that if your location is somewhere else you might need to give the same permission to the parent of the folder that apache is looking it.
Also note that you can add the www-data user to the group that has the permission in your file system if you are hesitate to make that directory global.</p>

<p>Once you have it configured, all you need then is to configure you Java app to use the port 8010 defined above:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;Connector port="8010" protocol="AJP/1.3" redirectPort="8443"/&gt;</span></code></pre></td></tr></table></div></figure>


<p>One last thing: I had to change the deploy context of the Java app from /app to / (root):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  &lt;Context docBase="my-app" path="/" reloadable="true" source="org.eclipse.jst.j2ee.server:my-app"/&gt;&lt;/Host&gt;</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/23/rails-create-a-deploy-script-with-ease/">Rails: Create a Deploy Script With Ease</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-23T16:51:00-08:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2013</time>
        
         | <a href="/blog/2013/02/23/rails-create-a-deploy-script-with-ease/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I was finding myself having to deploy manually everytime I push something to github, so I&#8217;ve decided to write a deploy shell script to help with this task. Coming from a Java background, I found that creating a deploy script for rails is so much easier. Here is the meat of it:</p>

<p>In deploy.sh</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/bash
</span><span class='line'>#first kill the server if its running
</span><span class='line'>kill -9 `lsof -i :80 | awk '{if (NR!=1) {print $2}}'`
</span><span class='line'>pushd ~/codetipdaily
</span><span class='line'>#then pull from gh
</span><span class='line'>git pull origin master
</span><span class='line'>#assets
</span><span class='line'>rake assets:clean
</span><span class='line'>rake assets:precompile
</span><span class='line'>#start server as daemon
</span><span class='line'>rails server -e production -p 80 --daemon
</span><span class='line'>popd</span></code></pre></td></tr></table></div></figure>


<p>That was a piece of cake!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/23/rails-production-environment-is-missing-application-dot-js-and-application-dot-css/">Rails: Production Environment Is Missing application.js and application.css</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-23T16:03:00-08:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2013</time>
        
         | <a href="/blog/2013/02/23/rails-production-environment-is-missing-application-dot-js-and-application-dot-css/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>The problem</h3>

<p>So I&#8217;m working on deploying my rails app to production, but I was seeing some weirdness when I ran it in production mode. Firstly, the application resources pointed to application.js and application.css even though my template was not change (ie. <code> &lt;%= stylesheet_link_tag    "application", :media =&gt; "all" %&gt;</code> and <code> &lt;%= javascript_include_tag "application" %&gt;</code>. That led to me believe something was wrong. In addition, when I ran <code>rake assets:precompile</code>, nothing was generated to the <code>public/assets</code> folder.</p>

<h3>What was wrong</h3>

<p>I checked my application.rb, and the <code>config.assets.enabled</code> was set to <code>true</code>. Then I realized that when I first created the app, I turned off that setting in <code>production.rb</code>. Simply turning it back on allowed the compilation of assets and leading rails to resolve to the right path (and not application.js/css).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/22/grails-and-intellij-discard-old-dependencies/">Grails and Intellij: Discard Old Dependencies</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-22T10:36:00-08:00" pubdate data-updated="true">Feb 22<span>nd</span>, 2013</time>
        
         | <a href="/blog/2013/02/22/grails-and-intellij-discard-old-dependencies/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So I&#8217;m working on a project that relies on a custom plugin, and it was listed as a dependency. However, I wanted it to reference a relative path instead. This was what was listed originally:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>In BuildConfig.groovy
</span><span class='line'>...
</span><span class='line'>  plugins {
</span><span class='line'>      test ":code-coverage:1.2.5"
</span><span class='line'>      test ":spock:0.7"
</span><span class='line'>      compile ":hibernate:2.0.0"
</span><span class='line'>      compile ":quartz:1.0-RC2"
</span><span class='line'>      compile ":rest:0.7"
</span><span class='line'>      compile ":springcache:1.3.1"
</span><span class='line'>          compile ":mycustomplugin:1.0"
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>In order to make it use your project relative project mycustomplugin (instead of fetching it from Archiva using maven), perform the following steps:</p>

<ol>
<li>Change your BuildConfig.groovy &#8211; remove the above decl in the plugins block.</li>
<li>Update your BuildConfig.groovy to add the following:</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grails.plugin.location.'mycustomplugin' = "../mycustomplugin"</span></code></pre></td></tr></table></div></figure>


<ol>
<li>Run <code>grails refresh-dependencies</code> in Intellij</li>
</ol>


<p>Once it refreshes then you should be able to reference the plugin in your source tree rather than from remote.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/8/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/6/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/07/24/chrome-extension-and-cookies-not-being-sent/">Chrome Extension and cookies not being sent when doing ajax calls</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/08/mongodb-easily-query-on-a-minimum-array-size-of-a-field/">MongoDB - easily query on a minimum array size of a field.</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/23/tips-on-foolproofing-your-seo/">Tips on Foolproofing your SEO</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/17/experience-in-a-tech-acclerator-halfway-point/">Experience in a Tech Acclerator - Halfway Point</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/14/rails-issue-with-module-in-lib-folder/">Rails issue with module in lib folder</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/tommytcchan">@tommytcchan</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'tommytcchan',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("tommytcchan", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/tommytcchan" class="twitter-follow-button" data-show-count="false">Follow @tommytcchan</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/tommytcchan?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Tommy Chan (informotion software) -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tommyssoftwareblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
