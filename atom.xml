<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tommy Chan's software blog (@tommytcchan)]]></title>
  <link href="http://tommytcchan.github.com/atom.xml" rel="self"/>
  <link href="http://tommytcchan.github.com/"/>
  <updated>2014-03-18T00:00:39-07:00</updated>
  <id>http://tommytcchan.github.com/</id>
  <author>
    <name><![CDATA[Tommy Chan (informotion software)]]></name>
    <email><![CDATA[tommytcchan@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Experience in a Tech Acclerator - Halfway Point]]></title>
    <link href="http://tommytcchan.github.com/blog/2014/03/17/experience-in-a-tech-acclerator-halfway-point/"/>
    <updated>2014-03-17T22:16:00-07:00</updated>
    <id>http://tommytcchan.github.com/blog/2014/03/17/experience-in-a-tech-acclerator-halfway-point</id>
    <content type="html"><![CDATA[<p>Last week marked the halfway point of being in batch 8 of the 500 startups tech acclerator. Our company <a href="https://www.venuespot.co">VenueSpot</a> has entered the accelerator in January and I want to take a moment to reflect at this point, both in terms of my personal life and work life.</p>

<h1>The Highs</h1>

<h2>The Batchmates</h2>

<p>Being in a pressure cooker environment with 30+ of your peers who are also trying to make it would scare quite a few people. However, it&#8217;s quite contrary to what you would think. People are super nice in the batch and will go out of your way to help you in any way they can. When we drove down from San Francisco, we didn&#8217;t have anywhere to stay. One of the batch teams actually offered us their space (a shutout to the guys at <a href="http://www.remarkhq.com">Remark</a>). We stayed there for about 2 weeks while we looked for an apartment nearby. So I would say that this experience has been made a lot better with the batch mates.</p>

<h2>The 500 Network</h2>

<p>500 startups has an extensive network of people who are either directly involved in 500 and it has really been a great learning experience. We&#8217;ve had people coming in from all over town &#8211; Paypal, Microsoft, Trulia, Twilio, Pinterest, AirBnb, Prominent VCs such as Paul Graham. We got a bunch of great advice on such as how to measure your KPIs, tips on UI/UX, and stories of early days from founders. We have barely scratch the surface as my co-founder is now in the process of connecting with other folks from the network as we raise an advisory round with preferred market cap.</p>

<h2>The Tech Community</h2>

<p>Being a technical co-founder, I&#8217;ve always being jealous of all of the great things happening here in the valley. Coming down to the valley makes me realize what I&#8217;ve been missing. I go to a lot of meetups in Vancouver but it&#8217;s nothing compared to the numbers of meetups here. It really is the epicenter of technology, so it really is no wonder why everyone comes here. The people here are super smart and for an aspiring developer, this is the place you should be.</p>

<h2>The San Francisco Weather</h2>

<p>Coming from Vancouver, Canada, it was really a treat for us to experience the great sunny weather that we&#8217;ve been having. It really boosts morale when you are walking to work with nothing but blue skies.</p>

<p><img src="http://s3.amazonaws.com/static_garage/2014-02-19%2008.49.40.jpg" alt="Sunny SF" /></p>

<h1>The Lows</h1>

<h2>The Distractions</h2>

<p>Coming into the acclerator, I didn&#8217;t really know what to expect. I mean, we were working 70+ hours a week and I didn&#8217;t think that was going to change. That is still true to this date (we probably work about 80+ hours a week right now). So that wasn&#8217;t unexpected. What was unexpected though was all the distractions that you have being an acclerator. There is a whole bunch of things that happen throughout the week. One of the advice that was given to us was that you can spend all your time in the acclerator going to meetups and events, so you really have to focus.</p>

<h2>Weeks of Desolation</h2>

<p>Coming into the acclerator, we realized it was going to be tough for us to be in San Francisco where we don&#8217;t have a presence, and sure enough it felt like the you have the weight of the world on your shoulders. This was true especially in week 4. 1/3 of the acclerator was over, and we were scratching our heads in terms of what to do. We barely had any traction in the new city and we were stressing out about the looming deadline (aka Demo Day) in May. I remember having a conversation with my co-founder about pivoting to something completely different. I think it&#8217;s one of those things that every team goes through (&#8220;Are we building the right thing for our customers? Is it a problem that people actually care about?&#8221;). It&#8217;s super stressful when you&#8217;re in that situation and you hear that another company in your cohort is making $20,000 dollars a day.</p>

<h1>The unexpected</h1>

<h2>The fire</h2>

<p>Last week was one of the craziest weeks of my life. We started of the week feeling great (more on this in the vitamins section). We were getting some traction and we have developed a better vision in terms of the next steps. Then the fire happened. If you don&#8217;t know what I mean, do a search on SF fire on Google News. It was a freakin&#8217; <em>6 alarm fire that happened right across the street!</em> It was the biggest fire in over a decade, and it happend 30 feets in front of our apartment. Honestly it was the craziest thing (see below for images). At first, being the pyro that I was, I was hoping it would keep burning and burning (I know I need some psychological help)&#8230;but then I saw a picture which show the apartment next to it and I quickly realized that it was our building. At that point I realized we were in a heap of trouble as our 2 dogs Oreo and Kandi were trapped inside. So we quickly took a cab and had the guy drop us off as close as possible. We got to the door and was quickly confronted by the police who told us to stay back. After multiple pleas we were able to be escorted by an officer into the building&#8230;while we were running into the building I was thinking how close we were to the fire&#8230;we can literally feel the fire on our faces. When we entered the building it was like the scene of a movie&#8230;smoke everywhere, water running everywhere, firefighters yelling. It felt surreal. Luckily we got the dogs out and we were all safe. We did have to stay at Remark&#8217;s place for a few more days (thanks Remark!).</p>

<p><img src="http://s3.amazonaws.com/static_garage/2014-03-12%2021.35.47.jpg" alt="The fire" /></p>

<h2>The food made with love</h2>

<p>After my co-founder and I settled in, we quickly realized that we were eating a lot of crappy food that we were used to. That&#8217;s because my awesome wife wasn&#8217;t there. Our health got a lot better after I flew to Seattle to pick her up (so we could both drive down). She&#8217;s our cheerleader and I&#8217;m really grateful for that.</p>

<h2>The vitamins</h2>

<p>I have to admit, we&#8217;ve had really long days and I was really tired&#8230;but after experimenting with vitamins and supplements I feel a lot better. Maybe it&#8217;s a placebo effect but I&#8217;ve experienced a lot more energy. I do say it&#8217;s not the best experience though (I have to pop 7 pills at one time, once a day). I would recommend this to all future founders that work long days. Maybe it&#8217;s just me but the vitamins and the 5-HTP makes me feel happier.</p>

<p><img src="http://s3.amazonaws.com/static_garage/2014-03-17%2023.18.46.jpg" alt="The vitamins" /></p>

<h2>The fun times</h2>

<p>There are so many awesome things to do in SF. If only we had enough time to do them all. Some of the highlights were (in no particular order): going to the Napa Valley for wine tastings, a night out in the Mission district with the lovely wife, drunken nights with the crew, talking about trannies among other things =).</p>

<p><img src="http://s3.amazonaws.com/static_garage/2014-02-16%2014.51.30.jpg" alt="The fun" /></p>

<h2>The psychic abilities</h2>

<p>I believe that since I&#8217;ve moved down here, I&#8217;ve developed a form of energy that I can&#8217;t explain. Every time I have a headache, an act of nature happens. The first time I had a headache here, there was a 6.9 earthquake 500km away from San Francisco. The second time I had a bad headache, the next day the crazy fire happened. And get this&#8230;I had a slight headache last night, and the first thing this morning was an earthquake in Los Angeles (&lt; 500km away). What&#8217;s going on here? I&#8217;m sure to blog about it the next time I have a headache.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails issue with module in lib folder]]></title>
    <link href="http://tommytcchan.github.com/blog/2014/03/14/rails-issue-with-module-in-lib-folder/"/>
    <updated>2014-03-14T20:04:00-07:00</updated>
    <id>http://tommytcchan.github.com/blog/2014/03/14/rails-issue-with-module-in-lib-folder</id>
    <content type="html"><![CDATA[<p>I&#8217;m doing some refactoring work for <a href="www.venuespot.co">VenueSpot</a> and I was getting this error when I started my app after I moved some of the common code into a module:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NameError - uninitialized constant MyController::DataSource:</span></code></pre></td></tr></table></div></figure>


<p>Here was MyController:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class MyController
</span><span class='line'>  include DataSource
</span><span class='line'>  ...
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>So far so good, what about the DataSource file?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># lib/datasource.rb
</span><span class='line'>module DataSource
</span><span class='line'>  def get_mongo_db
</span><span class='line'>      db = MONGODB.db('info')
</span><span class='line'>      # init
</span><span class='line'>      ...
</span><span class='line'>      return db
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>In my application.rb:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config.autoload_paths += Dir["#{config.root}/lib/**/"]</span></code></pre></td></tr></table></div></figure>


<p>Okay review the code, and I want you to know what the problem is. Okay got it? Well I didn&#8217;t for about 10 mins. Guess what the issue was?</p>

<p>.
..
&#8230;
&#8230;.
&#8230;..</p>

<p>Alright I&#8217;ll keep you from the suspense.</p>

<p>It has to do with the file name. Since the module is <code>DataSource</code>, the file name should be data_source.rb!!</p>

<p>I blame it on Friday night coding and drinking while there is beer pong going on in the background. >.&lt;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails 3 - editing a user object that has a Single Table Inheritance STI]]></title>
    <link href="http://tommytcchan.github.com/blog/2014/02/14/rails-3-editing-a-user-object-that-has-a-single-table-inheritance-sti/"/>
    <updated>2014-02-14T09:57:00-08:00</updated>
    <id>http://tommytcchan.github.com/blog/2014/02/14/rails-3-editing-a-user-object-that-has-a-single-table-inheritance-sti</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to get into a tech accelerator: A co-founder's story]]></title>
    <link href="http://tommytcchan.github.com/blog/2014/02/06/how-to-get-into-a-tech-acclerator-a-co-founders-story/"/>
    <updated>2014-02-06T22:53:00-08:00</updated>
    <id>http://tommytcchan.github.com/blog/2014/02/06/how-to-get-into-a-tech-acclerator-a-co-founders-story</id>
    <content type="html"><![CDATA[<p>Our startup <a href="http://venuespot.co">venuespot.co</a>, based out of Vancouver, Canada was recently <a href="http://500.co/2014/02/03/batch-8-announcement/">announced</a> in an official 500startups post. We are 1 of 28 companies selected out of 1400+ to get a chance to be in Silicon Valley along with Dave McClure and his managing partners. Since then, a lot of my friends and ex-coworkers have asked me how we were able to achieve that. I want to dedicate this post to founders who aspire to get into tech acclerators. Keep in mind though that your mileage may vary, but I think this will be a good read for those who inspire to participate in one.</p>

<h1>Our Story</h1>

<p>My business partner and I, Jerome, met during start up weekend last year. We immediately got along and started chatting about what we did. Right off the bat I can tell that he was a driver and a go-getter. Unfortunately for him, at that point in time I wasn&#8217;t too interested in his idea. It was only after a few months later when we saw each other again at another start up weekend that I got to work closer with him. By then the business plan had pivoted into something that excited me. I myself is an event organizer for a local tech meetup group, and the idea of not having to waste time to look for a venue for my meetup excited me. It would be a system where you would tell the system what you wanted, and a bunch of algorithms would be used to match the venues that would be suitable for the event, and the system would send notifications to the matching venues which they would then place offers to host the event. It was in June of last year that we started working together and it took 3 good months of product development to get to a stage where we can show it in front of venues and event organizers.</p>

<h1>The road to 500starups - a few personal tips on how to get into an accelerator.</h1>

<blockquote><p>Be that jock in high school.</p></blockquote>

<p>No I don&#8217;t mean go and work out 3x a day for the next year. What I mean is that you should be the &#8216;popular&#8217; dude in high school that all the girls wanted. You see, the biggest fear of investors is that they will lose out on what turns out to be the next Facebook or Twitter. If they hear that another investor is investing in you, they would want to invest first. So you have to play that card to your advantage by hyping yourself up. The way we did that was we basically interviewed first with the 3rd tier accelerators, got letter of intents from them, then went to the 2nd tier accelerators (and told them we got accepted into the 3rd tier accelerator), also got intents from them, and then with those letters of intent, went after the top tier accelerators. The results were what you&#8217;d expect: after the first term sheet, we had no issues with getting a second, and a third, and then a fourth. We eventually decided on the fourth term sheet because it gave us the most connections to the big names.</p>

<p>That was the first strategy which worked pretty well. I don&#8217;t believe that was 100% of the reason why we got in. There&#8217;s also another reason:</p>

<blockquote><p>Have connections into the accelerators before you meet the managing partners.</p></blockquote>

<p>Think about it. If you were an interviewer for a position, would you want to hire someone who handed their resume through a site like Monster.com, or would you want to hire someone who was referred by someone you know and trust? One of the things I found was that the tech circle is very small, and that nowadays it&#8217;s sooooo easy to find connections via either social media or Angelist. If you can&#8217;t find someone you know that knows a managing partner at an accelerator, then in my opinion you should not deserve to be in an accelerator. For our strategy, we volunteered at a Techcrunch conference which gave us a chance to also meet a lead into the 500startups family, and that was another reason we were able to catch the attention of the partners at 500.</p>

<blockquote><p>Teamwork is everything.</p></blockquote>

<p>The partners at the accelerators want to know that your team can execute. No matter what, all the members of the team should be present at the interviews. All of the accelerators that gave us term sheets mentioned that we have a great team. There&#8217;s no doubt in my mind that we do but we certainly need to show the partners that we can work well together and execute as a team. Ideally you and your co-founder(s) should have been working for over 6 months.</p>

<h1>Conclusion</h1>

<p>To conclude, I think it is imperative that if you want to get into an accelerator, you need to follow a few good rules of thumb. That being said, nothing beats cold hard numbers. If you are getting millions of downloads per month then they might take exception to that. But for the rest of us, if you try to follow the 3 pieces of advice that I gave you, then your chances of getting accepted has just dramatically increased.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOS and Chrome crashing and hanging]]></title>
    <link href="http://tommytcchan.github.com/blog/2014/02/01/ios-and-chrome-crashing-and-hanging/"/>
    <updated>2014-02-01T22:49:00-08:00</updated>
    <id>http://tommytcchan.github.com/blog/2014/02/01/ios-and-chrome-crashing-and-hanging</id>
    <content type="html"><![CDATA[<p>So I spent a few hours of my Saturday trying to fix an issue that was occuring for on <a href="www.venuespot.co">venuespot</a>. I thought it had something to do with my code as it started to hang/freeze recently. The behavior was odd because it wasn&#8217;t actually a crash (I couldn&#8217;t find any crash logs under General > About Diagnostics &amp; Usage > Diagnostic &amp; Usage Data, which made it more difficult for me to troubleshoot.</p>

<p>When I turned to Google, I was told that it could be because of malformed HTML5 syntax, so I ran it through the <a href="http://validator.w3.org/">validator</a>. Seemed fine. At this point it was really scratching my head, and I proceeded to remove the vendor JavaScripts one by one. Still no luck.</p>

<p>I then proceeded to removing my own code. Still no luck.</p>

<h1>The Solution</h1>

<p>I went even as far as trying to hunt down the iOS header string and rendering a message to tell the user to use Safari. Still doesn&#8217;t work. So I thought, hmm, it as to be something that is added by a gem. Lo and behold, it was the <code>rack-mini-profiler</code> gem that was adding a bunch of js to the page. After I removed the gem, everything was fine. Yay time for a beer.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ruby uninitialized constant Geokit::LatLng]]></title>
    <link href="http://tommytcchan.github.com/blog/2014/01/26/ruby-uninitialized-constant-geokit-latlng/"/>
    <updated>2014-01-26T22:41:00-08:00</updated>
    <id>http://tommytcchan.github.com/blog/2014/01/26/ruby-uninitialized-constant-geokit-latlng</id>
    <content type="html"><![CDATA[<h1>The Problem</h1>

<p>While developing a map specific feature for <a href="http://venuespot.co">venuespot</a>, I came across an error similar to the following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>uninitialized constant MyController::Geokit</span></code></pre></td></tr></table></div></figure>


<p>At first thought I thoght that I had <code>require</code>d the wrong names, but no that was not the case. Okay what else could it be. I checked the gems and it was in there. It was driving me nuts but I finally figured it out.</p>

<h1>The solution</h1>

<p>I tested the library out by going on irb and tried to instantiate some of the classes. That worked. Then I took a look at the Gemfile.lock file and everything checked out. But little did I realize that I didn&#8217;t include it in my Gemfile, which was what was needed. So including the <code>geokit</code> gem in there made it work. So I guess the story of the day is that explicit <code>require</code> of libraries requires you also to add it to the Gemfile. Either that or from what I&#8217;ve read, install the gem manually (gem install geokit), then adding a require &#8216;geokit&#8217; to the top of vendor/plugins/geokit-rails/init.rb.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Wicked Wizards and lost session]]></title>
    <link href="http://tommytcchan.github.com/blog/2014/01/11/rails-wicked-wizards-and-lost-session/"/>
    <updated>2014-01-11T18:03:00-08:00</updated>
    <id>http://tommytcchan.github.com/blog/2014/01/11/rails-wicked-wizards-and-lost-session</id>
    <content type="html"><![CDATA[<h1>The problem</h1>

<p>We&#8217;ve started using the Wicked gem for our wizard creations with events. Everything actually worked surprising well (using Wicked state machine). However I got stuck at an issue where if a user is logged in and starts the wizard flow, he/she would be logged out upon hitting the wizard controller.</p>

<h1>The solution</h1>

<p>I took a look at the source code and couldn&#8217;t find anything. After some digging around I realized it was my own fault. You see, on my home page I have a form that POSTed to the new wizard controller. However I was using the <code>&lt;form ...</code> notation, which meant that the security token was not generate, which meant rails will create a new session.</p>

<p>Therefore the solution was to do something like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;%= form_tag('/events/building/build', method: 'post'...</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rails and geokit acts_as_mappable through not working]]></title>
    <link href="http://tommytcchan.github.com/blog/2014/01/08/rails-and-geokit-acts-as-mappable-through-not-working/"/>
    <updated>2014-01-08T17:04:00-08:00</updated>
    <id>http://tommytcchan.github.com/blog/2014/01/08/rails-and-geokit-acts-as-mappable-through-not-working</id>
    <content type="html"><![CDATA[<p>At <a href="http://www.venuespot.co">venuespot</a>, we are using a matching algorithm to ensure that we match relevant information with the venues. One of the things is using a distance calculator with geokit. In the examples it talks about how one can use the <code>acts_as_mappable</code> to ensure your model has access to the right methods.</p>

<p>It also talked about it is able to use the <code>:through</code> mechanism. Here&#8217;s the example they provided:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Location &lt; ActiveRecord::Base
</span><span class='line'>  belongs_to :locatable, :polymorphic =&gt; true
</span><span class='line'>  acts_as_mappable
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>class Company &lt; ActiveRecord::Base
</span><span class='line'>  has_one :location, :as =&gt; :locatable  # also works for belongs_to associations
</span><span class='line'>  acts_as_mappable :through =&gt; :location
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>However, my model isn&#8217;t using polymorphic belongs_to (yet), but in theory I should be able to do something like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Company.within(distance, :origin =&gt; @somewhere)</span></code></pre></td></tr></table></div></figure>


<p>However, this proved to be a problem because the db didn&#8217;t like it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SELECT `venues`.*, 
</span><span class='line'> (ACOS(least(1,COS(0.8595746566072073)*COS(-2.1485003092050197)*COS(RADIANS(locations.lat))*COS(RADIANS(locations.lng))+
</span><span class='line'> COS(0.8595746566072073)*SIN(-2.1485003092050197)*COS(RADIANS(locations.lat))*SIN(RADIANS(locations.lng))+
</span><span class='line'> SIN(0.8595746566072073)*SIN(RADIANS(locations.lat))))*3963.19)
</span><span class='line'> AS distance FROM `locations` WHERE ((locations.lat&gt;48.38258088287847 AND locations.lat&lt;50.11741911712155 AND locations.lng&gt;-124.42871224851768 AND locations.lng&lt;-121.7712877514823)) AND ((
</span><span class='line'> (ACOS(least(1,COS(0.8595746566072073)*COS(-2.1485003092050197)*COS(RADIANS(locations.lat))*COS(RADIANS(locations.lng))+
</span><span class='line'> COS(0.8595746566072073)*SIN(-2.1485003092050197)*COS(RADIANS(locations.lat))*SIN(RADIANS(locations.lng))+
</span><span class='line'> SIN(0.8595746566072073)*SIN(RADIANS(locations.lat))))*3963.19)
</span><span class='line'> &lt;= 60)) //problem with locations not found</span></code></pre></td></tr></table></div></figure>


<h1>The solution</h1>

<p>It turns out that I needed to include the associated association in order for it to know what it&#8217;s matching on:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Venue.includes(:location).within(radius, :origin =&gt; [lat, lng]).all.each do |venue|
</span><span class='line'>    ...
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Capistrano 3 and rbenv sshkit upgrade to 1.3]]></title>
    <link href="http://tommytcchan.github.com/blog/2014/01/06/capistrano-3-and-rbenv-sshkit-upgrade-to-1-dot-3/"/>
    <updated>2014-01-06T17:02:00-08:00</updated>
    <id>http://tommytcchan.github.com/blog/2014/01/06/capistrano-3-and-rbenv-sshkit-upgrade-to-1-dot-3</id>
    <content type="html"><![CDATA[<p>I spend a bit of time today figuring out why the capistrano rbenv gem doesn&#8217;t work. First it was complaining that I had an older version of the sshkit library (it was being used by an older version of the fog library). Upgraded the fob library, but it was complaining of this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cap aborted!
</span><span class='line'>Unable to activate capistrano-rbenv-2.0.0, because sshkit-1.3.0 conflicts with sshkit (~&gt; 1.
</span><span class='line'>2.0)
</span><span class='line'>/home/tchan/repo/venuespot/Capfile:19:in `&lt;top (required)&gt;'
</span><span class='line'>/home/tchan/.rvm/gems/ruby-2.0.0-p247@venuespot/gems/capistrano-3.0.1/lib/capistrano/applica
</span><span class='line'>tion.rb:22:in `load_rakefile'
</span><span class='line'>/home/tchan/.rvm/gems/ruby-2.0.0-p247@venuespot/gems/capistrano-3.0.1/lib/capistrano/applica
</span><span class='line'>tion.rb:12:in `run'</span></code></pre></td></tr></table></div></figure>


<p>After digging through the commit history of the <a href="gem">https://github.com/capistrano/rbenv/pull/21/files</a> I realized it&#8217;s a library version issue.</p>

<p>Uninstall the capistrano gem, then add this in your Gemfile (until the author bumps the version):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem 'capistrano-rbenv', :git =&gt; 'git@github.com:capistrano/rbenv.git', :ref =&gt; '67222bbce120323e422b051dcd167d8e2d3adbf0'</span></code></pre></td></tr></table></div></figure>


<p>Hope that helps someone!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Setting up Rails with Mixpanel on both the front end and back end]]></title>
    <link href="http://tommytcchan.github.com/blog/2014/01/05/setting-up-rails-with-mixpanel-on-both-the-front-end-and-back-end/"/>
    <updated>2014-01-05T17:12:00-08:00</updated>
    <id>http://tommytcchan.github.com/blog/2014/01/05/setting-up-rails-with-mixpanel-on-both-the-front-end-and-back-end</id>
    <content type="html"><![CDATA[<p>At <a href="http://www.venuespot.co">venuespot</a>, we use Mixpanel. We&#8217;ve had an account for awhile actually, but didn&#8217;t really do anything with it. I upgraded our GA to use the new GA script, and needless to say the events management isn&#8217;t that great. That prompted me to look at Mixpanel again. In this article I will explain how one is able to set up events to track individual users going through the system without too much intrusive work.</p>

<h1>The Requirements</h1>

<p>We need a few things we wanted to use with our app:
1.  We want to track the different events that a user takes throughout our site, whether they are logged in or not.
2.  We wanted to blanket track <strong>all</strong> events, such as going to a controller#action.
3.  We don&#8217;t want it to affect the performance of our system too much, which meant hooking into Sidekiq for asynchronous processing.</p>

<h1>The approach</h1>

<p>If you followed the Mixpanel recommendations, they advise you to use the JavaScript library. This was a little limiting for us as we want to track when we send out emails and notifications to the users. So we took a 2 pronged approach:
1.  If the user isn&#8217;t signed in and is just browsing our site, we track those events with the JS client library.
2.  Once they have signed up/in though, we will use server side calls to track the events in an async manner.</p>

<h1>The Setup</h1>

<p>You will need a few things:
1.  Sign up with Mixpanel, and install the javascript.
2.  Place the javascript in your asset pipeline folder and reference it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># application.js
</span><span class='line'>//= require mixpanel/mixpanel</span></code></pre></td></tr></table></div></figure>


<h1>The implementation</h1>

<p>So let&#8217;s start with the part where the user is not logged in but we want to track their actions. We need to tell mixpanel that a new user on our site. Now we will be using <code>localStorage</code> to store our anonymous user.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># venuespot_tracker.js
</span><span class='line'>function VenueSpotTracker() {
</span><span class='line'>
</span><span class='line'>    this.createOrGetUser = function () {
</span><span class='line'>        //check to see if localStorage is defined, omitted for brevity's sake
</span><span class='line'>        ...
</span><span class='line'>
</span><span class='line'>        if (!localStorage.vs_user) {
</span><span class='line'>            localStorage.vs_user = rand(12);
</span><span class='line'>            mixpanel.identify(localStorage.vs_user);
</span><span class='line'>            mixpanel.people.set({
</span><span class='line'>                "$created": new Date(),
</span><span class='line'>                "$last_login": new Date()
</span><span class='line'>            });
</span><span class='line'>        }
</span><span class='line'>        return localStorage.vs_user;
</span><span class='line'>    };
</span><span class='line'>
</span><span class='line'>    this.homePageViewed = function() {
</span><span class='line'>        this.createOrGetUser();
</span><span class='line'>        this.track(document.location.pathname + ' page viewed'); //method omitted for brevity
</span><span class='line'>
</span><span class='line'>        mixpanel.track_links("a", "Clicked Link", {
</span><span class='line'>            referrer: document.referrer
</span><span class='line'>        });
</span><span class='line'>    };
</span><span class='line'>
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>var vsTracker = new VenueSpotTracker();
</span><span class='line'>...
</span><span class='line'>vsTracker.homePageViewed();</span></code></pre></td></tr></table></div></figure>


<p>A couple of interesting things&#8230;I omitted some of the code, I&#8217;m sure you can fill in the missing pieces.</p>

<p>Another interesting thing: if there is no user defined, we have to call <code>identify</code> and then set some attributes to let Mixpanel we want to track this anonymous user.</p>

<p>We also want to track all of the links the user clicks, so we use provided <code>track_links</code> method.</p>

<p>Once that&#8217;s done, we just sit back and see the results: http://screencloud.net/v/jLLi</p>

<h3>Sending the info to the backend</h3>

<p>Okay, so far we&#8217;ve got stats on users who have not signed up. What happens when they sign up? We don&#8217;t want to lose the previous history that they had, so we have to call the <code>alias</code> api method after they&#8217;ve logged in so that we can register them. For this we use the <code>mixpanel-ruby</code> gem.</p>

<p>Now you might be asking, why don&#8217;t we just continue to use the JS library? Well I thought about this for a few minutes. If you did that, you would have to make sure that we send over the email down to the client. Also, any time you want to do any tracking you would have to do the same. Finally we also wanted to track the history when we send out emails. That&#8217;s a backend job so that makes it really difficult.</p>

<p>Hopefully I&#8217;ve convinced you of why we want to use the backend library.</p>

<ol>
<li>First thing is to include the gem in your gemfile.</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem 'mixpanel-ruby'</span></code></pre></td></tr></table></div></figure>


<ol>
<li>Now on the sign up flow, you have to add in a hidden field to the back end registration:</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$(document).ready(function() {
</span><span class='line'>    $('&lt;input&gt;').attr({
</span><span class='line'>        type: 'hidden',
</span><span class='line'>        id: 'mix_panel_temp_id',
</span><span class='line'>        name: 'mix_panel_temp_id',
</span><span class='line'>        value: venuespotTracker.createOrGetUser()
</span><span class='line'>    }).appendTo('form');
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<p>We need this because we want to do the alias in the controller:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># create
</span><span class='line'>def create
</span><span class='line'>...
</span><span class='line'>        MixpanelAliasWorker.perform_async(@user.email, params[:mix_panel_temp_id], @user.first_name, @user.last_name, @user.phone, @user.type)
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Notice here we are using Sidekiq to perform our linking in an async manner. The Mixpanel api has a few methods to do with async, but I feel that this is an easier approach.</p>

<p>In MixpanelAliasWorker, this is what happens:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>require 'mixpanel-ruby'
</span><span class='line'>
</span><span class='line'># Does alias and link up the email address
</span><span class='line'>class MixpanelAliasWorker
</span><span class='line'>    include Sidekiq::Worker
</span><span class='line'>
</span><span class='line'>    def mixpanel()
</span><span class='line'>        Mixpanel::Tracker.new(ENV['mix_panel'])
</span><span class='line'>    end
</span><span class='line'>
</span><span class='line'>    def perform(email, old_id, first_name, last_name, phone, user_type)
</span><span class='line'>        tracker = mixpanel()
</span><span class='line'>        tracker.alias email, old_id #synchrious call
</span><span class='line'>        tracker.people.set(email, {
</span><span class='line'>            '$first_name' =&gt; first_name,
</span><span class='line'>            '$last_name' =&gt; last_name,
</span><span class='line'>            '$email' =&gt; email,
</span><span class='line'>            '$phone' =&gt; phone,
</span><span class='line'>            'User Type' =&gt; user_type
</span><span class='line'>        });
</span><span class='line'>    end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>What happens here is that when a user is registered, we alias the old temp id we created in the front end with the actual email.</p>

<p>Once we do that then Mixpanel will now associate all new events with that email with the previous &#8216;anonymous&#8217; user.</p>

<ol>
<li>Now that we have the user correctly linked, the next step is to track all of the events. For that we will go into the <code>ApplicationController</code> and add this method:</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def track_with_mixpanel
</span><span class='line'>    if (current_user)
</span><span class='line'>
</span><span class='line'>        if params[:id]
</span><span class='line'>            instance = controller_name.classify.constantize.find(params[:id])
</span><span class='line'>            id = instance.respond_to?(:name) ? instance.name : params[:id]
</span><span class='line'>        end
</span><span class='line'>
</span><span class='line'>        MixpanelTrackWorker.perform_async(current_user.email, "Page View - #{self.class.to_s}##{self.instance_variable_get('@_action_name')} #{id}", { :controller =&gt; 'test', :action =&gt; 'test'})
</span><span class='line'>    end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Let me explain what this does. We check that the current user exists, and also check if there is a params[:id]. If there is, we want to know which model that belongs to.</p>

<p>Rails is pretty awesome because you can actually find that out by using <code>controller_name.classify</code>, and then make that into a constant, and finally invoke it to find the model.</p>

<p>I know this isn&#8217;t scalable if we have tens of thousands of users, but our stage we value metrics so in the future this will have to be modified, but it gives us a good tracking for a user and all the actions they do once they are signed in.</p>

<p>Here&#8217;s an example: http://screencloud.net/v/kLnw</p>

<p>So there you have it folks. Ping me if you have any issues with setting this up!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Best practices with nginx and rails]]></title>
    <link href="http://tommytcchan.github.com/blog/2013/12/28/best-practices-with-nginx-and-rails/"/>
    <updated>2013-12-28T09:08:00-08:00</updated>
    <id>http://tommytcchan.github.com/blog/2013/12/28/best-practices-with-nginx-and-rails</id>
    <content type="html"><![CDATA[<p>While searching on the internet for a related question, I came across a <a href="https://gist.github.com/mikhailov/3052776">gist</a> that had the best practices for deploying a rails app with unicorn. Please refer to it but I thought I would comment on a few of the best practices that I observed.</p>

<ol>
<li><p>Using the <code>include</code> directive.
This proved to be a great solution for when you want some of your configs checked into source control. You can control the settings without having to muck around in <code>/opt/nginx/conf</code> so you know what you are deploying when you restart nginx.</p></li>
<li><p>Adding the gzip headers to the static resources
The author compiled nginx with <code>--with-http_gzip_static_module</code> which he used later:</p></li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  location ~ ^/(assets|images|javascripts|stylesheets|swfs|system)/ {
</span><span class='line'>    gzip_static       on;
</span><span class='line'>    expires           max;
</span><span class='line'>    add_header        Cache-Control public;
</span><span class='line'>    add_header        Last-Modified "";
</span><span class='line'>    add_header        ETag "";
</span><span class='line'> 
</span><span class='line'>    open_file_cache          max=1000 inactive=500s;
</span><span class='line'>    open_file_cache_valid    600s;
</span><span class='line'>    open_file_cache_errors   on;
</span><span class='line'>    break;
</span><span class='line'>  }</span></code></pre></td></tr></table></div></figure>


<p>For myself I didn&#8217;t want to add those headers to the <code>assets</code> folder, but for everything it was really sensible to do so.</p>

<ol>
<li>Adding a <code>open_file_cache</code> for static assets. From the above, we can see that there is the <code>open_file_cache</code> decl. This directive sets the cache activity on. This is good when you have a busy server and so you don&#8217;t have to open the file descriptor every time.</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Foundation 5 and Reveal plugin not working issues]]></title>
    <link href="http://tommytcchan.github.com/blog/2013/12/22/foundation-5-and-reveal-plugin-not-working-issues/"/>
    <updated>2013-12-22T19:46:00-08:00</updated>
    <id>http://tommytcchan.github.com/blog/2013/12/22/foundation-5-and-reveal-plugin-not-working-issues</id>
    <content type="html"><![CDATA[<p>I&#8217;m working on a client project today using the new Foundation 5 version and I had a hard time with trying to get reveal to work.</p>

<p>I followed the docs on how one might be able to run an example. Downloaded the 5.0.2 library and extracted foundation.min.js. Now in the docs it mentions you also need to extract the individual plugins as well. Well guess what I did that and it still didn&#8217;t work.</p>

<p>After digging around the code I realized that the authors already has it in the minifieid version &#8211; by including the library again it somehow screws up and doesn&#8217;t work.</p>

<p>Removed the full <code>foundation.reveal.js</code> to make it work.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails and adding an environment to headers]]></title>
    <link href="http://tommytcchan.github.com/blog/2013/12/16/rails-and-adding-an-environment-to-headers/"/>
    <updated>2013-12-16T19:07:00-08:00</updated>
    <id>http://tommytcchan.github.com/blog/2013/12/16/rails-and-adding-an-environment-to-headers</id>
    <content type="html"><![CDATA[<p>One of the more annoying things that happens when you have multiple environements is that when a mail comes in, you don&#8217;t really know what is what. Therefore it&#8217;s smart to have an environment shown on the email headers so you don&#8217;t accidentally confuse it with the live system. To do that is relatively trivial:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># base_mailer.rb
</span><span class='line'>class BaseMailer &lt; ActionMailer::Base
</span><span class='line'>
</span><span class='line'>    default from: "hello@venuespot.co" #TODO move these out
</span><span class='line'>    default to: "tom@venuespot.co"
</span><span class='line'>
</span><span class='line'>    def mail(headers={}, &block)
</span><span class='line'>
</span><span class='line'>        unless Rails.env == 'production'
</span><span class='line'>            headers[:subject].insert(0, "[#{Rails.env}] - ")
</span><span class='line'>        end
</span><span class='line'>
</span><span class='line'>        super(headers, &block)
</span><span class='line'>    end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>And then just extend that class instead of the the default <code>ActionMailer::Base</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Azure and Confluence firewall rule setup problem and solution]]></title>
    <link href="http://tommytcchan.github.com/blog/2013/12/15/azure-and-confluence-firewall-rule-setup/"/>
    <updated>2013-12-15T21:37:00-08:00</updated>
    <id>http://tommytcchan.github.com/blog/2013/12/15/azure-and-confluence-firewall-rule-setup</id>
    <content type="html"><![CDATA[<p>Our company, VenueSpot.co has a Bizspark account from Microsoft which gives us $150/mn server credit for 3 years. Thanks Microsoft!</p>

<p>However I had to spend some time trying to configure the server esp with the ports so they play nicely. First off you have to enable your firewall, either doing it through <code>iptables</code> or <code>ufc</code>. Initially, I did it using the latter:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo ufw enable
</span><span class='line'>sudo ufw allow 8090</span></code></pre></td></tr></table></div></figure>


<p>So far, so good. I then proceeded to the Azure admin interface to map the port from 8090 => 8090. Guess what that doesn&#8217;t work (at least not for me.)</p>

<p>After some experimentation I go it to work by removing the port 80 => 80 mapping, and instead I created a new mapping that points 80 => 8090.</p>

<p>Coming from an AWS background, this made no sense. Surely I should be able to open any port I wanted&#8230;however that didn&#8217;t work for me.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Secret Ingredient to a co-founder's success - Love]]></title>
    <link href="http://tommytcchan.github.com/blog/2013/12/15/secret-ingredient-to-a-co-founders-success-love/"/>
    <updated>2013-12-15T01:09:00-08:00</updated>
    <id>http://tommytcchan.github.com/blog/2013/12/15/secret-ingredient-to-a-co-founders-success-love</id>
    <content type="html"><![CDATA[<p>I&#8217;ve been writing a lot of technical stuff previously and it has come to my attention that sooner or later I will have to write about the high level stuff. So let&#8217;s talk about one of the things that is dear and close to me - my significant other. I&#8217;ll have to admit, I joke with ex-coworkers about how much she needs me, but deep down inside she is my rock and without her I would probably have lost focus by now. I have a letter that is addressed to her that I&#8217;d like to share.</p>

<blockquote><p>To my hunny,</p>

<p>I&#8217;m writing to you on my first day of unemployment. Do you remember the last time I was unemployed? I did&#8230;you had to carry our butts for 2 years until I was done school. Fast forward 7 years and here we are all over again&#8230;only this time the stakes are higher.</p>

<p>I feel like this is such a turning point in our lives and I really want to express how thankful I am to have you by my side through thick and thin. You are my everything and I can&#8217;t imagine not having you with me on this journey.</p>

<p>I know the next few months/years will not be easy so I apologize in advance right now for all the hardships that will be coming up. I apologize for those late working nights where I won&#8217;t be able to spend alone time with you. I apologize for all nights that we&#8217;re apart together because I&#8217;m travelling for business. I apologize for all the stupid things I&#8217;ll say after a long day at work. I apologize for boring you with all my talk about how using Puma is better than Unicorn for our Rails server implementation. And last but not least I apologize in advance for making all the sacrifices that you make in order for me to chase my dreams. Please still cook for me during those times.</p>

<p>Now I know there will be some rainy days up ahead but I&#8217;ll hold you tight under my umbrella and we&#8217;ll laugh it off. There will also be those freezing days but in those times I&#8217;ll hold you tighter and we&#8217;ll laugh even harder. I want you to know that whatever the weather is, the sun is always above. In those stormy days I want you to remember those sunny tunes and let these great memories carry us through. Please try to be patient with me and still laugh at my corny jokes. There will also be times where the business doesn&#8217;t go the way we planned and I promise not to let that jeopardize the special relationship that we have. I love you with all my heart and soul and I am so grateful that you are mine. Life is a journey and although sometimes there are obstacles along the way, we will look back and realize that sometimes it&#8217;s not important where we end up, but how we got there.</p>

<p>Love,</p>

<p>Tommy</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Jasmine Spies on a 2nd level object]]></title>
    <link href="http://tommytcchan.github.com/blog/2013/12/03/jasmine-spies-on-a-2nd-level-object/"/>
    <updated>2013-12-03T16:03:00-08:00</updated>
    <id>http://tommytcchan.github.com/blog/2013/12/03/jasmine-spies-on-a-2nd-level-object</id>
    <content type="html"><![CDATA[<p>I&#8217;ve been trying to mock a 2 level object that looks like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    mockSoundService = {
</span><span class='line'>        getSound: function () {
</span><span class='line'>            return {
</span><span class='line'>                volume: function () {
</span><span class='line'>                }
</span><span class='line'>            };
</span><span class='line'>        }
</span><span class='line'>    };</span></code></pre></td></tr></table></div></figure>


<p>Naturally, I thought it would work with something like this in my test:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    spyOn(mockSoundService.getSound(), 'volume');
</span><span class='line'>    service.closeIntroVideo();
</span><span class='line'>
</span><span class='line'>    expect(service.getPlayer()).toBeNull();
</span><span class='line'>    expect(mockSoundService.getSound().volume).toHaveBeenCalled();</span></code></pre></td></tr></table></div></figure>


<p>However, I kept getting errors like these:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Expected a spy, but got undefined.</span></code></pre></td></tr></table></div></figure>


<p>It turns out that you need to break apart the 2nd level object that was nested. Therefore the final product should look something like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    mockSound = {
</span><span class='line'>        volume: function () {
</span><span class='line'>        }
</span><span class='line'>    };
</span><span class='line'>
</span><span class='line'>    mockSoundService = {
</span><span class='line'>        getSound: function () {
</span><span class='line'>            return mockSound;
</span><span class='line'>        }
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<p>and now in your mocks you can do something like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    spyOn(mockSound, 'volume');
</span><span class='line'>    spyOn(mockState, 'go');
</span><span class='line'>    service.closeIntroVideo();</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails: Add a custom migrate script for running migrations in another location.]]></title>
    <link href="http://tommytcchan.github.com/blog/2013/10/21/rails-add-a-custom-migrate-script-for-running-migrations-in-another-location/"/>
    <updated>2013-10-21T19:14:00-07:00</updated>
    <id>http://tommytcchan.github.com/blog/2013/10/21/rails-add-a-custom-migrate-script-for-running-migrations-in-another-location</id>
    <content type="html"><![CDATA[<p>I am currently in the process of refactoring some code in a Rails project for a client, and one of the things that I wanted to do was to separate the database migration scripts that are from the base frameworks (Discourse was used as the base) and the ones I will be adding. This will give a good historical view of all the custom migrations so we don&#8217;t have to go through each one. But in order to do that I had to write my own custom rake task to rake the rake tasks:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>namespace :db do
</span><span class='line'>    desc "Migrate the database by going through the standard migrate folder first, then the custom 1017 folder (options: VERSION=x, VERBOSE=false, SCOPE=blog)."
</span><span class='line'>    task :custom_migrate =&gt; [:environment, :load_config] do
</span><span class='line'>        ActiveRecord::Migration.verbose = ENV["VERBOSE"] ? ENV["VERBOSE"] == "true" : true
</span><span class='line'>        ActiveRecord::Migrator.migrate(ActiveRecord::Migrator.migrations_paths, ENV["VERSION"] ? ENV["VERSION"].to_i : nil) do |migration|
</span><span class='line'>            ENV["SCOPE"].blank? || (ENV["SCOPE"] == migration.scope)
</span><span class='line'>        end
</span><span class='line'>        ActiveRecord::Migrator.migrate('db/migrate/1017', ENV["VERSION"] ? ENV["VERSION"].to_i : nil) do |migration|
</span><span class='line'>            ENV["SCOPE"].blank? || (ENV["SCOPE"] == migration.scope)
</span><span class='line'>        end
</span><span class='line'>
</span><span class='line'>        Rake::Task['db:_dump'].invoke
</span><span class='line'>    end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Notice the last line where it delegates out to the <code>db:_dump</code> task. This is important as it writes out the schema as the end step.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails 3: joins and not ins]]></title>
    <link href="http://tommytcchan.github.com/blog/2013/10/05/rails-3-joins-and-not-ins/"/>
    <updated>2013-10-05T14:26:00-07:00</updated>
    <id>http://tommytcchan.github.com/blog/2013/10/05/rails-3-joins-and-not-ins</id>
    <content type="html"><![CDATA[<p>So I needed to write a complexish query for one of the queries for (VenueSpot.co)|[http://www.venuespot.co]. As we are only running a small instance on aws, I didn&#8217;t to waste time by traversing through my related models using <code>each</code>. I wanted to write a couple of more optimizing queries using the <code>joins</code> keyword and the NOT IN mechanism. At the end it looked like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@events = Event.joins(:event_durations).where("events.state = ? and is_published = ? and event_durations.start_date &gt; ? and events.id NOT IN (?)", 'active', true, DateTime.now, @previous_venue_bid_ids).group('events.id')</span></code></pre></td></tr></table></div></figure>


<p>One thing that tripped me up was that initially my <code>@previous_venue_bid_ids</code> was a string that had all the ids, but the api actually takes in an array of the ids, so just be really sure what you are passing is correct!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[wrong number of arguments (1 for 0)]]></title>
    <link href="http://tommytcchan.github.com/blog/2013/09/16/wrong-number-of-arguments-1-for-0/"/>
    <updated>2013-09-16T18:22:00-07:00</updated>
    <id>http://tommytcchan.github.com/blog/2013/09/16/wrong-number-of-arguments-1-for-0</id>
    <content type="html"><![CDATA[<p>So I&#8217;ve started getting the following error message when I started a json service that reads a model which is fog enabled (with s3):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wrong number of arguments (1 for 0) at messages.json.rabl where line #1 raised:</span></code></pre></td></tr></table></div></figure>


<p>I wasn&#8217;t getting this before, so what gives?</p>

<h1>Solution:</h1>

<p>It turned out that I was doing this to get the asset path:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>model.asset</span></code></pre></td></tr></table></div></figure>


<p>However, that only returns the AssetUploader instance, so when it tried to render it, it gave me the error. If you want just the path to s3, you will need the <code>to_s</code> appended to the end.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AngularJS: using the $event for an a tag can cause problems.]]></title>
    <link href="http://tommytcchan.github.com/blog/2013/09/01/angularjs-using-the-%24event-for-an-a-tag-can-cause-problems/"/>
    <updated>2013-09-01T12:01:00-07:00</updated>
    <id>http://tommytcchan.github.com/blog/2013/09/01/angularjs-using-the-$event-for-an-a-tag-can-cause-problems</id>
    <content type="html"><![CDATA[<p>So I was troubleshooting a bug on one of the projects that uses AngularJS. Consider this markup:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a href="http://tommytcchan.github.com/fooPage" data-ng-click="show($event)"&gt;&lt;span&gt;foobar!&lt;/span&gt;&lt;/a&gt;</span></code></pre></td></tr></table></div></figure>


<p>In the js, this was what was declared:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$scope.show = function (event) {
</span><span class='line'>  var href = event.target.href;
</span><span class='line'>  ...
</span><span class='line'>};</span></code></pre></td></tr></table></div></figure>


<p>Now, the interesting thing about this is that it <em>sometimes</em> works. The reason is that if you click on the link outside of the <span>, then the event.target resolves to the <a> tag. However, if you click within the span, then the event.target is the <span> tag, and there is no href there, thus throwing an error.</p>

<p>The fix:</p>

<p>The solution is actually pretty simple. Instead of using <code>event.target</code>, use <code>event.currentTarget</code>. That resolves to the <a> and it will work for all cases.</p>

<p>Hope that helps!</p>
]]></content>
  </entry>
  
</feed>
